var Diagram=MindFusion.Diagramming.Diagram,Behavior=MindFusion.Diagramming.Behavior,AbstractionLayer=MindFusion.AbstractionLayer,Alignment=MindFusion.Diagramming.Alignment,AnchorPattern=MindFusion.Diagramming.AnchorPattern,Shape=MindFusion.Diagramming.SimpleShape,Font=MindFusion.Drawing.Font,Rect=MindFusion.Drawing.Rect,Text=MindFusion.Drawing.Text,Thickness=MindFusion.Drawing.Thickness,Event=MindFusion.Diagramming.Events,GlassEffect=MindFusion.Diagramming.GlassEffect,Style=MindFusion.Diagramming.Style,SimpleShape=MindFusion.Diagramming.SimpleShape,ImageAlign=MindFusion.Diagramming.ImageAlign,LinkShape=MindFusion.Diagramming.LinkShape,id=0,OrgChartNode=function(a,b){AbstractionLayer.initializeBase(OrgChartNode,this,[a]),this.childNodes=[],this.redimTable(3,3),this.getCell(1,3).setColumnSpan(2),this.getCell(0,0).setRowSpan(1),this.getCell(0,1).setText("               "),this.getCell(1,1).setFont(new Font("Verdana",3.5,!0,!1)),this.getCell(1,2).setFont(new Font("Verdana",3.5,!0,!1)),this.getCell(1,0).setFont(new Font("Verdana",3.5,!0,!1)),this.getCell(1,3).setFont(new Font("Verdana",3,!1,!1)),this.configureCells(),this.setCaptionHeight(0),this.setHandlesStyle(MindFusion.Diagramming.HandlesStyle.MoveOnly),this.setCellFrameStyle(MindFusion.Diagramming.CellFrameStyle.None),this.setBrush("purple"),this.setShape(SimpleShape.RoundedRectangle),this.setTitle("title"),this.setBoss(b),this.setHierarchy(),this.resize(),this.setAnchorPattern(AnchorPattern.fromId("TopInBottomOut"))};OrgChartNode.prototype={updateCanvasElements:function(){this.setFields(),AbstractionLayer.callBaseMethod(OrgChartNode,this,"updateCanvasElements")},getTitle:function(){return this.title},setTitle:function(a){this.title!==a&&(this.title=a,this.invalidate())},getFullName:function(){return this.fullName},setFullName:function(a){this.fullName!==a&&(this.fullName=a,this.invalidate())},getImageLocation:function(){return this.nodeImageLocation},setImageLocation:function(a){if(this.nodeImageLocation!=a){var b=MindFusion.Diagramming.ImageAlign;this.nodeImageLocation=a,this.getCell(0,0).setImageLocation(a),this.getCell(0,0).setImageAlign(b.Stretch),this.invalidate()}},getComment:function(){return this.comments},setComment:function(a){this.comments!==a&&(this.comments=a,this.invalidate())},setId:function(){this.id=id,id++},getId:function(){return this.id},setFields:function(){this.setCaptionHeight(0),this.getCell(2,1).setText(this.title),this.getCell(0,0).setImagePadding(new Thickness(0,0,0,0)),this.boss!=null&&this.boss.id!=null&&this.getCell(2,2).setText("Boss: "+this.boss.id),this.getCell(1,3).setText(this.comments),this.getCell(1,3).text.padding=new Thickness(0,0,0,0),this.setHierarchy(),this.setColor()},resize:function(){var a=this.bounds.height,b=this.getColumn(0).width;this.resizeToFitText(!0,!0);var c=this.bounds.height-a;this.getCell(0,0).imagePadding.top+=c/2,this.getCell(0,0).imagePadding.bottom+=c/2,this.getColumn(0).width=b,this.bounds.width+=b},configureCells:function(){for(var a=0;3>a;a++)for(var b=0;3>b;b++)this.getCell(a,b).editable=!1;this.getCell(2,1).editable=!0,this.getCell(2,2).editable=!1},setBoss:function(a){a!=this.boss&&(this.boss=a,this.setHierarchy(),this.invalidate())},setHierarchy:function(){this.boss==null?this.hierarchy=0:this.boss.hierarchy==null?this.hierarchy=1:(this.hierarchy=this.boss.hierarchy+1,this.boss.addChild(this));for(var a=0;a<this.childNodes;a++)this.childNodes[a].setHierarchy();this.setColor()},setColor:function(){var a=this.hierarchy%6;switch(a){case 0:this.setBrush("#ea684f");break;case 1:this.setBrush("#e0e9e9");break;case 2:this.setBrush("#9caac6");break;case 3:this.setBrush("#669acc");break;case 4:this.setBrush("#678b99");break;case 5:this.setBrush("#616a7f");break;case 6:this.setBrush("#c0c0c0");break;default:this.setBrush("#c0c0c0");}},addChild:function(a){for(var b=!1,c=0;c<this.childNodes.length;c++)this.childNodes[c].id==a.id&&(b=!0);b||this.childNodes.push(a)},removeChild:function(a){var b=this.childNodes.indexOf(a);-1<b&&this.childNodes.splice(b,1)},resetHierarchy:function(){this.setHierarchy();for(var a=0;a<this.childNodes.length;a++)this.childNodes[a].setBoss(this),this.childNodes[a].resetHierarchy()},isChild:function(a){for(var b=0;b<this.childNodes.length;b++)if(a===this.childNodes[b])return!0;return!1}};var diagram=null,tree=null;$(document).ready(function(){AbstractionLayer.registerClass(OrgChartNode,"OrgChartNode",MindFusion.Diagramming.TableNode),tree=new MindFusion.Graphs.TreeLayout,tree.direction=MindFusion.Graphs.LayoutDirection.TopToBottom,tree.linkType=MindFusion.Graphs.TreeLayoutLinkType.Cascading,$("#diagram")[0].oncontextmenu=function(){return!1},diagram=Diagram.create($("#diagram")[0]),diagram.setBehavior(Behavior.Custom),diagram.setShowGrid(!1),diagram.setAllowSelfLoops(!1),diagram.setAutoScroll(!0),diagram.setLinkShape(LinkShape.Cascading),diagram.setBackBrush("#ffffff"),diagram.addEventListener(Event.clicked,function(a,b){var c=b.getMouseButton(),d=b.getMousePosition();if(2===c){var e=new OrgChartNode(a,void 0);e.setBounds(new Rect(d.x,d.y,160,160)),e.resize(),a.addItem(e),a.arrangeAnimated(tree)}}),diagram.addEventListener(Event.animatedLayoutCompleted,function(a){a.resizeToFitItems()}),diagram.addEventListener(Event.nodeClicked,onNodeClicked),diagram.addEventListener(Event.nodeSelected,function(a,b){b.getNode().setZIndex(700)}),diagram.addEventListener(Event.nodeDeselected,function(a,b){b.getNode().setZIndex(0)}),diagram.addEventListener(Event.linkCreated,onLinkCreated),diagram.addEventListener(Event.cellTextEdited,function(a,b){b.getCell().onEdited(a,b)}),diagram.addEventListener(Event.linkCreated,function(a){a.arrangeAnimated(tree)}),diagram.addEventListener(Event.nodeDeleted,function(a){a.arrangeAnimated(tree)}),diagram.addEventListener(Event.linkDeleted,function(a,b){var c=b.getLink().destination;c.boss.removeChild(c),c.boss=void 0,c.resetHierarchy(),c.getCell(2,2).setText(""),a.arrangeAnimated(tree)}),diagram.addEventListener(Event.nodeModified,function(a,b){if(!b.getNode().boss)for(var c=b.getMousePosition(),d=a.getNodesAt(c),e=0;e<d.length;e++)if(d[e]!==b.getNode()&&!b.getNode().isChild(d[e])){b.getNode().setBoss(d[e]);var f=a.getFactory().createDiagramLink(d[e],b.getNode());styleLink(f),b.getNode().resetHierarchy(),a.arrangeAnimated(tree),a.resizeToFitItems();break}}),diagram.addEventListener(Event.enterInplaceEditMode,function(a,b){var c=b.getItem().getCellKind();switch(c){case 0:case 1:case 2:default:b.getControl().setAttribute("placeholder","Title:");}});var a=new OrgChartNode(diagram);a.setBounds(new Rect(25,15,60,25)),a.setTitle("Kiriting"),a.resize(),diagram.addItem(a),diagram.arrangeAnimated(tree),diagram.setAllowInplaceEdit(!1),diagram.setBehavior(Behavior.Modify)});function editNode(a,b){var c=b.getNode().cellFromPoint(b.getMousePosition()),d=b.getNode(),e=!1;c.cell!=null&&!0==c.cell.editable&&(e=!0),e&&(a.beginEdit(b.getNode(),b.getMousePosition()),$("diagram_inplaceInput").attr("placeholder","url"),c.cell.onEdited=function(a,b){if(e){if(c.cell.image)null!=b.getNewText()&&""!=b.getNewText()&&"undefined"!=b.getNewText&&(d.setImageLocation(b.getNewText()),c.cell.text.height=0,c.cell.text.text="");else if(3>c.row){var f=d.getColumn(0).width;d.resizeToFitText(!0,!0),d.getColumn(0).width=f,d.bounds.width+=f}else if(3===c.row){var g=d.bounds.height,f=d.getColumn(0).width;d.resizeToFitText(!0,!0);var h=d.bounds.height-g;d.getCell(0,0).imagePadding.top+=h/2,d.getCell(0,0).imagePadding.bottom+=h/2,d.getColumn(0).width=f,d.bounds.width+=f}0==c.row&&2==c.column&&(d.fullName=b.newText),1==c.row&&2==c.column&&(d.title=b.newText),3==c.row&&1==c.column&&(d.comments=b.newText),a.arrangeAnimated(tree)}},d.getCellKind=function(){return c.cell.image?0:0==c.row?1:1==c.row?2:3==c.row?3:4})}function onLinkCreated(a,b){!0===b.getLink().permission&&styleLink(b.getLink())}function styleLink(a){a.setPen("#2d3956"),a.setStrokeThickness(2),a.setHeadShape()}function createNode(a,b){var c=b.getNode(),d=new OrgChartNode(a,c);d.setBounds(c.getBounds()),a.addItem(d),d.resize();var e=a.getFactory().createDiagramLink(b.getNode(),d);e.permission=!0,styleLink(e),a.arrangeAnimated(tree),a.resizeToFitItems()}function onNodeClicked(a,b){var c=b.getMouseButton();0===c?editNode(a,b):2===c&&createNode(a,b)}